# Загрузка фотографий на Google Drive

## Обзор

Приложение поддерживает загрузку фотографий на Google Drive с организацией по датам и настраиваемым корневым каталогом. Загрузка происходит в фоновом режиме с быстрым возвратом на главный экран.

## Основные возможности

### 1. Автоматическая организация по датам

- Фотографии автоматически сохраняются в папки с названием в формате `YYYY-MM-DD`
- Папки создаются автоматически, если не существуют
- Каждая фотография получает уникальное имя с датой и временем

### 2. Настраиваемый корневой каталог

- В настройках можно выбрать корневую папку для всех фотографий
- По умолчанию используется папка "Техосмотр"
- Структура: `Корневая папка → Папка с датой → Фотографии`

### 3. Фоновая загрузка

- Фото загружается на Google Drive в фоновом режиме
- Мгновенный возврат на главный экран после нажатия "Сохранить"
- Уведомления о результате загрузки через Toast сообщения

## Настройки Google Drive

### Настройка корневого каталога

1. Привяжите Google аккаунт в разделе **Google аккаунт**
2. В поле "Корневой каталог для фотографий" введите название папки
3. По умолчанию: "Техосмотр"
4. Папки с датами будут создаваться внутри этого каталога

### Пример структуры папок

```
Google Drive/
└── Техосмотр/
    ├── 2024-01-15/
    │   ├── 2024-01-15_14-30-25.jpg
    │   └── 2024-01-15_14-35-12.jpg
    ├── 2024-01-16/
    │   ├── 2024-01-16_09-15-30.jpg
    │   └── 2024-01-16_16-45-22.jpg
    └── 2024-01-17/
        └── 2024-01-17_11-20-15.jpg
```

## Именование файлов

Фотографии получают имена в формате:

```
YYYY-MM-DD_HH-MM-SS.jpg
```

Пример: `2024-01-15_14-30-25.jpg`

## Процесс загрузки

### Фоновая загрузка

1. Сделайте фото
2. Нажмите кнопку "Сохранить" на экране предпросмотра
3. Мгновенно возвращаетесь на главный экран
4. Фото загружается на Google Drive в фоновом режиме
5. При включенной опции "Сохранять в галерею" фото также сохраняется локально
6. Показывается Toast уведомление о результате загрузки

### Уведомления

- **Успех**: Зеленое уведомление с именем загруженного файла
- **Ошибка**: Красное уведомление с описанием ошибки
- **Длительность**: 2 секунды с плавной анимацией

## Требования

### Google аккаунт

- Необходимо привязать Google аккаунт в настройках
- Требуются разрешения на доступ к Google Drive

### Настройка приложения

- В `app.config.ts` должны быть настроены Google Client ID
- Подробности в файле `GOOGLE_SETUP.md`

## Обработка ошибок

### Ошибки авторизации

- Проверьте подключение к интернету
- Убедитесь, что Google аккаунт привязан
- Попробуйте переавторизоваться в настройках

### Ошибки загрузки

- Проверьте доступ к Google Drive
- Убедитесь, что есть место в Google Drive
- Проверьте настройки разрешений

## Технические детали

### API Google Drive

- Используется Google Drive API v3
- Резюмируемая загрузка для больших файлов
- Автоматическое создание папок при необходимости

### Обработка изображений

- Фото обрабатывается перед загрузкой (размер, качество)
- Сохраняются EXIF данные с геолокацией
- Формат: JPEG

### Фоновая обработка

- Загрузка происходит в `setTimeout` для неблокирующего выполнения
- Использование глобального Toast контекста для уведомлений
- Плавные анимации появления и исчезновения уведомлений

### Безопасность

- Токены доступа хранятся локально
- Автоматическое обновление токенов
- Безопасная передача данных через HTTPS

## Устранение неполадок

### Фото не загружается

1. Проверьте подключение к интернету
2. Убедитесь, что Google аккаунт привязан
3. Проверьте настройки Google Drive
4. Попробуйте перезапустить приложение

### Папки не создаются

1. Проверьте права доступа к Google Drive
2. Убедитесь, что корневой каталог указан правильно
3. Попробуйте создать папку вручную в Google Drive

### Медленная загрузка

1. Проверьте скорость интернета
2. Уменьшите качество фото в настройках
3. Убедитесь, что размер фото не слишком большой

### Уведомления не появляются

1. Проверьте, что приложение активно
2. Убедитесь, что нет конфликтов с другими уведомлениями
3. Попробуйте перезапустить приложение

## Поддержка

При возникновении проблем:

1. Проверьте логи в консоли разработчика
2. Убедитесь, что все настройки корректны
3. Попробуйте переустановить приложение
4. Обратитесь к документации Google Drive API
